

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting Started &mdash; MiStaMover 0.1.0alpha documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.0alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="MiStaMover 0.1.0alpha documentation" href="index.html" />
    <link rel="next" title="Running Modes" href="modes.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="modes.html" title="Running Modes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">MiStaMover 0.1.0alpha documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="getting-started">
<span id="id1"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>MiStaMover has been built with the intention that it is simple to download, install, configure and run. It is packaged as a gzipped tar file so you can download it and install in a matter of minutes. This page explains how to create a test dataset and run mistamover to test it.</p>
<div class="section" id="downloading-and-installing-mistamover">
<h2>Downloading and Installing MiStaMover<a class="headerlink" href="#downloading-and-installing-mistamover" title="Permalink to this headline">¶</a></h2>
<p>Make sure you have at least Python 2.5 on your system. Then download the <a class="reference internal" href="download.html#current-source"><em>current version of MiStaMover</em></a>.</p>
<p>Unpack the source code with the <tt class="docutils literal"><span class="pre">tar</span></tt> command:</p>
<div class="highlight-python"><pre>tar -C &lt;DIRECTORY&gt; -xvzf mistamover-&lt;VERSION&gt;.tar.gz</pre>
</div>
<p>Where <tt class="docutils literal"><span class="pre">&lt;DIRECTORY&gt;</span></tt> is the directory into which you want to unpack the source and <tt class="docutils literal"><span class="pre">&lt;VERSION&gt;</span></tt> is the version you have downloaded. This directory must exist before you unpack the code.</p>
<p>For example, you might do:</p>
<div class="highlight-python"><pre>mkdir $HOME/mstmvr
VERSION=0.1.0-alpha
tar -C $HOME/mstmvr -xvzf mistamover-${VERSION}.tar.gz</pre>
</div>
</div>
<div class="section" id="the-directory-structure">
<h2>The Directory Structure<a class="headerlink" href="#the-directory-structure" title="Permalink to this headline">¶</a></h2>
<p>MiStaMover has a simple directory structure. Just change directory to where the code has been unpacked and you are ready to go:</p>
<div class="highlight-python"><pre>cd $HOME/mstmvr/mistamover-${VERSION}</pre>
</div>
<p>The sub-directories are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">bin/</span></tt></dt>
<dd>Contains the <tt class="docutils literal"><span class="pre">mistamover.py</span></tt> script used to run the tool, and other utility scripts.</dd>
<dt><tt class="docutils literal"><span class="pre">conf/</span></tt></dt>
<dd><dl class="first last docutils">
<dt>Contains the default <tt class="docutils literal"><span class="pre">global.ini</span></tt> configuration file and is the default location for</dt>
<dd>a data stream configuration files.</dd>
</dl>
</dd>
<dt><tt class="docutils literal"><span class="pre">doc/</span></tt></dt>
<dd>Contains the documentation in the <tt class="docutils literal"><span class="pre">html/</span></tt> sub-directory.</dd>
<dt><tt class="docutils literal"><span class="pre">lib/</span></tt></dt>
<dd>Contains the main library of python modules.</dd>
<dt><tt class="docutils literal"><span class="pre">log/</span></tt></dt>
<dd>An empty directory that is the default location for MiStaMover log files.</dd>
<dt><tt class="docutils literal"><span class="pre">test/</span></tt></dt>
<dd>Contains test code used when developing and extending MiStaMover.</dd>
</dl>
<p>Since the code is written in python there is nothing to build!</p>
<p>Note that it is possible to split the various directories across your linux distribution, for example moving the <tt class="docutils literal"><span class="pre">log/</span></tt> directory to a common logging location and the <tt class="docutils literal"><span class="pre">lib/</span></tt> directory into your python source. Be sure to make the appropriate changes to your configuration information and PYTHONPATH environment variable if you decide to move the directories.</p>
</div>
<div class="section" id="running-mistamover">
<h2>Running MiStaMover<a class="headerlink" href="#running-mistamover" title="Permalink to this headline">¶</a></h2>
<p>The best way to get started is to run MiStaMover as a <em class="xref std std-ref">one-off process</em>. This will work as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>MiStaMover is run at the command line</li>
<li>A global configuration file is specified</li>
<li>The global configuration identifies one data stream to be transferred</li>
<li>The data stream configuration file is read, specifying the incoming directory, transfer protocol, transfer mode (move or mirror) and target host details</li>
<li>MiStaMover sets up a sub-process to manage that data stream</li>
<li>The incoming directory is scanned for files and/or directories</li>
<li>Each file and/or directory is copied to the target host</li>
<li>The local version in the incoming directory is either deleted (for move) or untouched (for mirror)</li>
</ol>
</div></blockquote>
<p>The following options are available when running MiStaMover at the command line:</p>
<div class="highlight-python"><pre>bin/mistamover.py [ --one-off | --daemon | ] [&lt;GLOBAL_CONFIG_FILE&gt;]</pre>
</div>
<p>Where only one of the first four arguments must be specified. The <tt class="docutils literal"><span class="pre">&lt;GLOBAL_CONFIG_FILE&gt;</span></tt> is the location of the global configuration file you wish to use. This is an optional argument for which the default location is <tt class="docutils literal"><span class="pre">conf/global.ini</span></tt>.</p>
<p><strong>WARNING: The default transfer mode is &#8220;move&#8221;. Do not set your incoming directory to a location in which you intend to keep data without setting the transfer mode to &#8220;mirror&#8221;!</strong></p>
<p>We can run MiStaMover with:</p>
<div class="highlight-python"><pre>bin/mistamover.py --one-off conf/global.ini</pre>
</div>
<p>However, it will just sit there and do nothing because we haven&#8217;t configured it to work with any datasets.</p>
<p>Press <tt class="docutils literal"><span class="pre">Ctrl^C</span></tt> to quit MiStaMover and let&#8217;s take a look at a global configuration file.</p>
</div>
<div class="section" id="the-global-configuration-file">
<h2>The Global Configuration File<a class="headerlink" href="#the-global-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>Note that all the sections and settings of the configuration files are described in the <a href="#id2"><span class="problematic" id="id3">:ref:`Configuration Files &lt;configuration&gt;`_</span></a> section.</p>
<p>MiStaMover works by reading a single global configuration file (typically located at <tt class="docutils literal"><span class="pre">conf/global.ini</span></tt>) which in turn defines a set of data streams in its <tt class="docutils literal"><span class="pre">global:data_streams</span></tt> setting. For each data stream found, a separate configuration file will be read and then a sub-process started to manage the transfers related to that specific data stream.</p>
<p>The following is a global configuration file that defines a data stream called <em>my_outputs</em>. It will transfer the data in &#8220;move&#8221; transfer mode (deleting the local version once successfully copied remotely):</p>
<div class="highlight-python"><pre>#
# Global config file - can override values per dataset by giving them the
# same section and key in the dataset config file
#

[global]

# global section is intended for stuff which is unlikely to be overridden
# per-dataset (although technically there is nothing to prevent a 'global'
# section in the dataset config file)

homedir = /home/users/me
top = /home/users/me/work
base_data_dir = $(global:top)/data
config_dir = $(global:homedir)/mistamover/conf
base_incoming_dir = $(global:base_data_dir)/incoming
data_stream_list = my_outputs
general_poll_interval = 3

[incoming]
require_arrival_monitor = False
control_file_extension = mistamover-ctrl-bes
thankyou_file_extension = mistamover-thanks-bes
stop_file = .stop

[outgoing]
transfer_protocol = rsync_ssh
control_file_extension = mistamover-ctrl-bss
receipt_file_extension = mistamover-rcpt-bss
thankyou_file_extension = mistamover-thanks-bss
target_uses_arrival_monitor = True
retry_count = 3
receipt_file_poll_count = 100
receipt_file_poll_interval = 5
always_zip = False
dir_size_limit = 1000.
stop_file = .stop
stop_file_poll_interval = 600

[logging]
base_log_dir = $(global:homedir)/mistamover/log
log_level = INFO
port = 2000

[email]
from = mistamover@localhost
#threshold = ERROR
threshold = CRITICAL
recipient = me@localhost
subject = Error from MiStaMover
smarthost = localhost

[rsync_ssh]
transfer_mode = move
cmd = /usr/bin/rsync

[disk_space_monitor]
base_priority = 100
# thresholds in MB - description in lib/DiskSpaceMonitor.py
level_good = 1500
level_low = 1000
level_vlow = 500
# note re poll_interval: 1GBit/s, maxed out, is 7.5GB/minute
poll_interval = 60</pre>
</div>
</div>
<div class="section" id="the-data-stream-configuration-file">
<h2>The Data Stream Configuration File<a class="headerlink" href="#the-data-stream-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>The data stream configuration file is called <tt class="docutils literal"><span class="pre">conf/dataset_my_outputs.ini</span></tt> and looks like:</p>
<div class="highlight-python"><pre>[data_stream]
priority = 200
name = my_outputs
transfer_unit = file
status = RUNNING
directory = $(global:top)/outgoing/my_outputs

[incoming]
require_arrival_monitor = False

[outgoing]
target_host = localhost
transfer_protocol = rsync_ssh
# if this was True then rsync would run in mirror mode
target_uses_arrival_monitor = False
target_dir = $(global:top)/remote/my_outputs

[rsync_ssh]
username = ME
transfer_mode = mirror
use_checksum = True
check_size = True</pre>
</div>
<p>The data stream configuration file can override any settings made in the global configuration file for the specific data stream of interest. The main settings that should be set for each data stream are:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">name</span></tt> - the name of the data_stream</li>
<li><tt class="docutils literal"><span class="pre">directory</span></tt> - where the data stream transfer process will monitor for files/directories that should be transferred</li>
<li><tt class="docutils literal"><span class="pre">target_host</span></tt> - the full IP address or valid alias of the target machine that data will be transferred to</li>
<li><tt class="docutils literal"><span class="pre">transfer_protocol</span></tt> - the protocol that will be used to transfer data to the target machine</li>
<li><tt class="docutils literal"><span class="pre">target_dir</span></tt> - the directory on the target host where data should be transferred</li>
</ul>
</div></blockquote>
<p>See the <a class="reference internal" href="configs.html#configuration"><em>Configuring MiStaMover</em></a> section for the full list of available settings. In the above example, the <tt class="docutils literal"><span class="pre">[outgoing]</span></tt> section sets the <tt class="docutils literal"><span class="pre">transfer_protocol</span></tt> to <tt class="docutils literal"><span class="pre">rsync_ssh</span></tt>. This implies that there must be a section in the data stream (or global) configuration file called <tt class="docutils literal"><span class="pre">[rsync_ssh]</span></tt> that provides further details as required.</p>
<p>Once you have created a global configuration file and at least one data stream configuration file you are ready to run MiStaMover. As stated above, the tool can be invoked at the command-line as follows:</p>
<p>If you wish to run MiStaMover with a test dataset please see the section on <a class="reference internal" href="testing.html#config-test-data"><em>Configuring a test data stream</em></a>.</p>
</div>
<div class="section" id="example-data-stream-configuration-files">
<h2>Example Data Stream Configuration files<a class="headerlink" href="#example-data-stream-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>The best way to get started is to copy and modify the <a class="reference internal" href="configs.html#example-configs"><em>Example Configuration Files</em></a>.</p>
</div>
<div class="section" id="adding-a-new-mistamover-data-stream">
<h2>Adding a new MiStaMover Data Stream<a class="headerlink" href="#adding-a-new-mistamover-data-stream" title="Permalink to this headline">¶</a></h2>
<p>A MiStaMover data stream corresponds to a configuration file that instructs the main MiStaMover process to start a separate process that monitors a directory for incoming files/directories and transfers them on to a target directory on a remote (or local) server.</p>
<p>New data streams can be added without stopping MiStaMover. The global configuration file is regularly re-scanned by the main process and the &#8220;data_stream_list&#8221; is read. If a new data stream name appears in the list then MiStaMover will look for the associated configuration file and will then start a new process for that specific Data Stream.</p>
<p>See the <a class="reference internal" href="configs.html#configuration"><em>Configuring MiStaMover</em></a> section for more details about configuring a new data stream.</p>
</div>
<div class="section" id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Getting Started</a><ul>
<li><a class="reference internal" href="#downloading-and-installing-mistamover">Downloading and Installing MiStaMover</a></li>
<li><a class="reference internal" href="#the-directory-structure">The Directory Structure</a></li>
<li><a class="reference internal" href="#running-mistamover">Running MiStaMover</a></li>
<li><a class="reference internal" href="#the-global-configuration-file">The Global Configuration File</a></li>
<li><a class="reference internal" href="#the-data-stream-configuration-file">The Data Stream Configuration File</a></li>
<li><a class="reference internal" href="#example-data-stream-configuration-files">Example Data Stream Configuration files</a></li>
<li><a class="reference internal" href="#adding-a-new-mistamover-data-stream">Adding a new MiStaMover Data Stream</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="intro.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="modes.html"
                        title="next chapter">Running Modes</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/getting_started.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="modes.html" title="Running Modes"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="index.html">MiStaMover 0.1.0alpha documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright See STFC Licernce..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>