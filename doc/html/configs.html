

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring MiStaMover &mdash; MiStaMover 0.1.0alpha documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.0alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="MiStaMover 0.1.0alpha documentation" href="index.html" />
    <link rel="next" title="Advanced Features" href="features.html" />
    <link rel="prev" title="Running Modes" href="modes.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="features.html" title="Advanced Features"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="modes.html" title="Running Modes"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">MiStaMover 0.1.0alpha documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuring-mistamover">
<span id="configuration"></span><h1>Configuring MiStaMover<a class="headerlink" href="#configuring-mistamover" title="Permalink to this headline">¶</a></h1>
<p><strong>MiStaMover</strong> is told how to run, where to run and what to run by a set of configuration files. The format is based on the Python INI file format [REF: TOFIX], with a few extensions.</p>
<p>The most important of configuration files is the:</p>
<blockquote>
<div><ul class="simple">
<li>Global Configuration File</li>
</ul>
</div></blockquote>
<p>This defines the global information MiStaMover needs and also sets up defaults for items defined in the:</p>
<blockquote>
<div><ul class="simple">
<li>Data Stream Configuration Files</li>
</ul>
</div></blockquote>
<p>These define such information as what a data stream is called, where its data can be found on arrival, which protocol should be used to transfer the data and the address of the remote host that data should be forwarded to.</p>
<div class="section" id="global-configuration-files">
<h2>Global Configuration Files<a class="headerlink" href="#global-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>TBC</p>
</div>
<div class="section" id="data-stream-configuration-files">
<h2>Data Stream Configuration Files<a class="headerlink" href="#data-stream-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>The following is an example of a data stream-specific configuration file. It contains information for the <cite>mytest</cite> Data Stream:</p>
<div class="highlight-python"><pre>[data_stream]
name = mytest
status = RUNNING
completion_file = thatsallfolks
priority = 50

[incoming]
require_arrival_monitor = False

[outgoing]
control_file_extension = ctrl12
receipt_file_extension = rcpt12
transfer_protocol = ftp
target_host = localhost
target_dir = /xfers/incoming/mytest2
target_uses_arrival_monitor = True
receipt_file_poll_count = 5
receipt_file_poll_interval = 1
#stop_file_poll_interval = 5

[ftp]
#username = .....
#password = ......

[email]
recipient = simon.diming@diming-froim.com</pre>
</div>
<p>The various sections and options in the configuration file are explained in detail below:</p>
</div>
<div class="section" id="data-stream">
<h2>data_stream<a class="headerlink" href="#data-stream" title="Permalink to this headline">¶</a></h2>
<p>name</p>
<blockquote>
<div>The name of the data_stream</div></blockquote>
</div>
<div class="section" id="example-configuration-files">
<span id="example-configs"></span><h2>Example Configuration Files<a class="headerlink" href="#example-configuration-files" title="Permalink to this headline">¶</a></h2>
<p>The following example configuration files can be copied and modified as you require. It is easier to start with these than to build new files from scratch. The examples are:</p>
<blockquote>
<div><ul class="simple">
<li>Global configuration example</li>
<li>Rsync-over-SSH data stream &#8220;move&#8221; example</li>
<li>Rsync-over-SSH data stream &#8220;mirror&#8221; example</li>
<li>Rsync-native data stream &#8220;move&#8221; example</li>
<li>GridFTP data stream &#8220;move&#8221; example</li>
<li>FTP data stream &#8220;move&#8221; example (no arrivals monitor)</li>
<li>FTP data stream &#8220;move&#8221; example (with arrivals monitor)</li>
</ul>
</div></blockquote>
<p><strong>TBC - need to cover all the above examples in section below!!!</strong></p>
<p>Here is an example of a <em>one-off</em> config file that uses the <tt class="docutils literal"><span class="pre">rsync-over-ssh</span></tt> transfer protocol:</p>
<div class="highlight-python"><pre>#
# Global oneshot config file - can override values per data stream by giving them the
# same section and key in the data stream config file
#

[global]
# global section is intended for stuff which is unlikely to be overridden
# per-data stream (although technically there is nothing to prevent a 'global'
# section in the data stream config file)

homedir = /home/users/jhorton
top = /home/users/jhorton/Download/SVN/jah/jah
base_data_dir = $(global:top)/data
config_dir = $(global:top)/conf
base_incoming_dir = /home/users/jhorton/Download/SVN/jah/incoming
data_stream_list = jah3
general_poll_interval = 1

[data_stream]
priority = 200
name = jah3
transfer_unit = file
status = RUNNING
directory = /home/users/jhorton/Download/SVN/jah/outgoing/jah3

[incoming]
require_arrival_monitor = False
control_file_extension = mistamover-ctrl-bes
thankyou_file_extension = mistamover-thanks-bes
stop_file = .stop

[outgoing]
target_host = cmip-dev2
target_dir = /home/users/jhorton/incoming/jah
transfer_protocol = rsync
control_file_extension = mistamover-ctrl-bss
receipt_file_extension = mistamover-rcpt-bss
thankyou_file_extension = mistamover-thanks-bss
target_uses_arrival_monitor = False
retry_count = 3
receipt_file_poll_count = 100
receipt_file_poll_interval = 5
always_zip = False
dir_size_limit = 1000.
stop_file = .stop
stop_file_poll_interval = 600

[logging]
base_log_dir = /tmp/log
log_level = INFO
port = 2000

[email]
from = badc@rl.ac.uk
threshold = CRITICAL
recipient = john.horton@stfc.ac.uk
subject = Error from Local MiStaMover
smarthost = outbox.rl.ac.uk

[rsync]
username = jhorton
transfer_mode = move
cmd = /usr/bin/rsync

[disk_space_monitor]
base_priority = 100
# thresholds in MB - description in DiskSpaceMonitor.py
level_good = 1500
level_low = 1000
level_vlow = 500
# note re poll_interval: 1GBit/s, maxed out, is 7.5GB/minute
poll_interval = 60</pre>
</div>
<p>Here is an example of a Data Stream config file the uses FTP and an Arrivals Monitor:</p>
<div class="highlight-python"><pre>[data_stream]
priority = 200
name = ftp
transfer_unit = file
status = RUNNING
deletion_enabled = False
#
# location of files to transfer for this data_stream
#
directory = /home/users/mistamover/outgoing/my_data_stream

[incoming]
require_arrival_monitor = False

[outgoing]
#
# the host we are transfering files to
#
target_host = cmip-dev1
#
# the underlying protocol we are using to transfer files
#
transfer_protocol = ftp
target_uses_arrival_monitor = True
#
# the location on the target_host where we are placing the files
#
target_dir = /home/users/mistamover/incoming/my_data_stream

[ftp]
cmd = /usr/bin/ftp
username = mistamover
password = mistamover</pre>
</div>
<p>Here is an example of the Data Stream config file that will run on the other server (that uses use Arrivals monitor):</p>
<div class="highlight-python"><pre>[data_stream]
priority = 200
name = arrival_monitor
transfer_unit = file
status = RUNNING
deletion_enabled = False
#
# location of files to transfer for this data_stream
#
directory = /home/users/mistamover/incoming/my_data_stream

[incoming]
require_arrival_monitor = True

[outgoing]
#
# the host we are transfering files to
#
target_host = cmip-dev1
#
# the underlying protocol we are using to transfer files
# - it is none as we are only listening for incoming files
#
transfer_protocol = none</pre>
</div>
<p>Here is an example of a Data Stream config file that uses rsync ssh to mirror:</p>
<div class="highlight-python"><pre>[data_stream]
priority = 200
name = rsync_ssh
transfer_unit = file
status = RUNNING
directory = /home/users/mistamover/outgoing/rsync_ssh

[incoming]
require_arrival_monitor = False

[outgoing]
target_host = cmip-dev1
transfer_protocol = rsync_ssh
target_dir = /home/users/mistamover/incoming/rsync_ssh

[rsync_ssh]
username = mistamover
cmd = /usr/bin/rsync
transfer_mode = mirror</pre>
</div>
<p>Here is an example of a Data Stream config file that uses rsync native to move:</p>
<div class="highlight-python"><pre>[data_stream]
priority = 200
name = rsync_native
transfer_unit = file
status = RUNNING
#
# location of files to transfer for this data_stream
#
directory = /home/users/mistamover/outgoing/rsync_native

[incoming]
require_arrival_monitor = False

[outgoing]
#
# the host we are transfering files to
#
target_host = cmip-dev1
#
# the underlying protocol we are using to transfer files
#
transfer_protocol = rsync_native
target_uses_arrival_monitor = False
#
# the location on the target_host where we are placing the files
#
target_dir = Example/incoming/rsync_native

[rsync_native]
username = mistamover
password = mistamover
use_checksum = True
check_size = True
transfer_mode = move
cmd = /usr/bin/rsync</pre>
</div>
<p>Here is an example of Data Stream config file that uses gridftp to move:</p>
<div class="highlight-python"><pre>[data_stream]
priority = 200
name = gridftp
transfer_unit = file
status = RUNNING
deletion_enabled = False
#
# location of files to transfer for this data_stream
#
directory = /home/users/mistamover/outgoing/gridftp

[incoming]
require_arrival_monitor = False

[outgoing]
#
# the host we are transfering files to
#
target_host = mercury
#
# the underlying protocol we are using to transfer files
#
transfer_protocol = gridftp
target_uses_arrival_monitor = False
#
# the location on the target_host where we are placing the files
#
target_dir = /disks/almond1/mistamover/incoming/gridftp

[gridftp]
username = mistamover
cmd = /home/users/mistamover/globus/bin/globus-url-copy
port = 2811
proxy = myproxy.ceda.ac.uk
username = mistamover
password = mistamover</pre>
</div>
</div>
<div class="section" id="configuration-options">
<h2>Configuration Options<a class="headerlink" href="#configuration-options" title="Permalink to this headline">¶</a></h2>
<p>Here we define the sections that are defined in the configuration files and the options that can be set for each.</p>
<p>The sections can be as follows:</p>
<p>ADDMORE</p>
<dl class="docutils">
<dt><strong>``[rsync_ssh]``</strong></dt>
<dd>Defines settings required for using the rsync-over-SSH transfer protocol.</dd>
</dl>
<p>For each section, the following settings, their meanings and possible values are given below:</p>
<dl class="docutils">
<dt><strong>``[rsync_ssh]``</strong></dt>
<dd><dl class="first last docutils">
<dt>cmd</dt>
<dd>The full-path to the command that will be run.</dd>
<dt>transfer_mode</dt>
<dd>Set the transfer mode to either <tt class="docutils literal"><span class="pre">move</span></tt> or <tt class="docutils literal"><span class="pre">mirror</span></tt>.</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="extensions-to-the-standard-configuration-file-parsing">
<h2>Extensions to the Standard Configuration File Parsing<a class="headerlink" href="#extensions-to-the-standard-configuration-file-parsing" title="Permalink to this headline">¶</a></h2>
<p>In addition to supporting the INI file format understood by the python <tt class="docutils literal"><span class="pre">ConfigParser</span></tt> standard module we have also enabled a find-and-replace option based on the following syntax:</p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">$(section:option)</span></tt></div></blockquote>
<p>This allows you to re-use values that are set elsewhere in the configuration file (or the global configuration file???CHECK???TOFIX???TRUE???). For example:</p>
<div class="highlight-python"><pre>[global]
homedir = /home/users/me
top = /home/users/me/work
base_data_dir = $(global:top)/data
config_dir = $(global:homedir)/mistamover/conf</pre>
</div>
<p>Would substitute the value of &#8220;/home/users/me&#8221; for the string &#8220;$(global:homedir)&#8221;.</p>
</div>
<div class="section" id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuring MiStaMover</a><ul>
<li><a class="reference internal" href="#global-configuration-files">Global Configuration Files</a></li>
<li><a class="reference internal" href="#data-stream-configuration-files">Data Stream Configuration Files</a></li>
<li><a class="reference internal" href="#data-stream">data_stream</a></li>
<li><a class="reference internal" href="#example-configuration-files">Example Configuration Files</a></li>
<li><a class="reference internal" href="#configuration-options">Configuration Options</a></li>
<li><a class="reference internal" href="#extensions-to-the-standard-configuration-file-parsing">Extensions to the Standard Configuration File Parsing</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="modes.html"
                        title="previous chapter">Running Modes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="features.html"
                        title="next chapter">Advanced Features</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/configs.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="features.html" title="Advanced Features"
             >next</a> |</li>
        <li class="right" >
          <a href="modes.html" title="Running Modes"
             >previous</a> |</li>
        <li><a href="index.html">MiStaMover 0.1.0alpha documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright See STFC Licernce..
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>